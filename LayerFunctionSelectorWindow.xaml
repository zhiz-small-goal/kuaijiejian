<Window x:Class="Kuaijiejian.LayerFunctionSelectorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="é€‰æ‹©å›¾å±‚ç¼–è¾‘åŠŸèƒ½" 
        Height="600" Width="370"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="Transparent"
        AllowsTransparency="True"
        WindowStyle="None">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Window.Resources>

    <Border Background="White" 
            CornerRadius="12" 
            BorderThickness="0"
            ClipToBounds="True"
            MouseLeftButtonDown="Border_MouseLeftButtonDown">
        <Grid Margin="24" ClipToBounds="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>  <!-- æ ‡é¢˜æ  -->
                <RowDefinition Height="Auto"/>  <!-- æœç´¢æ¡† -->
                <RowDefinition Height="Auto"/>  <!-- æ“ä½œæŒ‰é’® -->
                <RowDefinition Height="*"/>     <!-- åŠŸèƒ½åˆ—è¡¨ -->
                <RowDefinition Height="Auto"/>  <!-- åº•éƒ¨æŒ‰é’® -->
            </Grid.RowDefinitions>

            <!-- æ ‡é¢˜æ  -->
            <Grid Grid.Row="0" Margin="0,0,0,16">
                <StackPanel>
                    <TextBlock Text="ðŸ”§ å›¾å±‚ç¼–è¾‘åŠŸèƒ½" 
                             FontSize="20" 
                             FontWeight="Bold" 
                             Foreground="#1E293B"/>
                    <TextBlock Text="é€‰æ‹©å¸¸ç”¨çš„å›¾å±‚æ“ä½œåŠŸèƒ½æ·»åŠ åˆ°å¿«æ·é”®é¢æ¿" 
                             FontSize="12" 
                             Foreground="#64748B" 
                             Margin="0,4,0,0"/>
                </StackPanel>
                
                <!-- å…³é—­æŒ‰é’® -->
                <Button Content="âœ•"
                        Width="30" Height="30"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Click="Cancel_Click"
                        Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="#94A3B8"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="FontSize" Value="18"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="6">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                              VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#FEE2E2"/>
                                    <Setter Property="Foreground" Value="#EF4444"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </Grid>

            <!-- æœç´¢æ¡† -->
            <Border Grid.Row="1" Background="#F8FAFC" CornerRadius="8" BorderThickness="0" Padding="12,10" Margin="0,0,0,12" Height="42">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- æœç´¢å›¾æ ‡ -->
                    <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="16" VerticalAlignment="Center" 
                               Margin="0,0,10,0" Foreground="#64748B"/>
                    
                    <!-- è¾“å…¥æ¡† -->
                    <TextBox x:Name="SearchBox" Grid.Column="1" BorderThickness="0" Background="Transparent" 
                             FontSize="14" VerticalAlignment="Center" TextChanged="SearchBox_TextChanged"
                             Text="" Foreground="#1E293B" FontWeight="Normal">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TextBox">
                                            <Grid>
                                                <ScrollViewer x:Name="PART_ContentHost" VerticalAlignment="Center"/>
                                                <TextBlock x:Name="PlaceholderText" 
                                                          Text="è¾“å…¥å…³é”®è¯æœç´¢åŠŸèƒ½..." 
                                                          Foreground="#94A3B8" 
                                                          FontSize="14"
                                                          VerticalAlignment="Center"
                                                          IsHitTestVisible="False">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Text, RelativeSource={RelativeSource TemplatedParent}}" Value="">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Grid>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    
                    <!-- æ¸…é™¤æŒ‰é’® -->
                    <Button x:Name="ClearSearchButton" Grid.Column="2" Content="âœ•" 
                            Width="24" Height="24" Margin="8,0,0,0"
                            Click="ClearSearch_Click" Cursor="Hand"
                            Visibility="Collapsed">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="#94A3B8"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="FontSize" Value="14"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    CornerRadius="12"
                                                    BorderThickness="0">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#E2E8F0"/>
                                        <Setter Property="Foreground" Value="#475569"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>

            <!-- æ“ä½œæŒ‰é’® -->
            <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,12">
                <Button Content="âœ“ å…¨é€‰" Click="SelectAll_Click" 
                        Width="70" Height="28" Margin="0,0,8,0"
                        Background="#F0F9FF" BorderBrush="#3B82F6" 
                        Foreground="#1E40AF" Cursor="Hand"/>
                <Button Content="âœ— å–æ¶ˆå…¨é€‰" Click="DeselectAll_Click" 
                        Width="90" Height="28"
                        Background="#FEF2F2" BorderBrush="#EF4444" 
                        Foreground="#991B1B" Cursor="Hand"/>
                <TextBlock x:Name="SelectionCountText" 
                         Text="å·²é€‰æ‹©: 0 ä¸ª" 
                         VerticalAlignment="Center" 
                         Margin="16,0,0,0"
                         FontSize="12" 
                         Foreground="#64748B"/>
            </StackPanel>

            <!-- åŠŸèƒ½åˆ—è¡¨ -->
            <Border Grid.Row="3" 
                    Background="#F8FAFC" 
                    CornerRadius="8" 
                    BorderThickness="0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="FunctionsList" Margin="8">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                          Margin="0,0,0,8"
                                          Cursor="Hand"
                                          HorizontalContentAlignment="Stretch">
                                    <CheckBox.Style>
                                        <Style TargetType="CheckBox">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="CheckBox">
                                                        <Border Background="#FAFBFC" 
                                                                CornerRadius="6" 
                                                                BorderThickness="0"
                                                                Padding="5">
                                                            <Grid>
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="Auto"/>
                                                                    <ColumnDefinition Width="*"/>
                                                                </Grid.ColumnDefinitions>

                                                                <Border Grid.Column="0"
                                                                        Width="16" Height="16"
                                                                        BorderBrush="#D1D5DB"
                                                                        BorderThickness="1"
                                                                        CornerRadius="3"
                                                                        Background="White"
                                                                        VerticalAlignment="Center"
                                                                        Margin="0,0,12,0">
                                                                    <TextBlock Text="âœ“"
                                                                               FontSize="12"
                                                                               FontWeight="Bold"
                                                                               Foreground="#3B82F6"
                                                                               HorizontalAlignment="Center"
                                                                               VerticalAlignment="Center"
                                                                               Visibility="{Binding IsChecked, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                                </Border>

                                                                <StackPanel Grid.Column="1">
                                                                    <TextBlock Text="{Binding DisplayName}" 
                                                                             FontSize="14" 
                                                                             FontWeight="SemiBold" 
                                                                             Foreground="#1E293B"/>
                                                                    <TextBlock Text="{Binding Description}" 
                                                                             FontSize="11" 
                                                                             Foreground="#64748B" 
                                                                             Margin="0,2,0,0"
                                                                             TextWrapping="Wrap"/>
                                                                </StackPanel>
                                                            </Grid>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </CheckBox.Style>
                                </CheckBox>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- åº•éƒ¨æŒ‰é’® -->
            <StackPanel Grid.Row="4" 
                       Orientation="Horizontal" 
                       HorizontalAlignment="Right" 
                       Margin="0,16,0,0">
                <Button Content="æ·»åŠ é€‰ä¸­åŠŸèƒ½" 
                        Click="Add_Click" 
                        Width="110" 
                        Height="36" 
                        Margin="0,0,12,0"
                        Background="#3B82F6" 
                        Foreground="White" 
                        FontWeight="Bold"
                        BorderThickness="0"
                        Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                CornerRadius="8" 
                                                Padding="16,8">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#2563EB"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button Content="å–æ¶ˆ" 
                        Click="Cancel_Click" 
                        Width="80" 
                        Height="36"
                        Background="#F1F5F9" 
                        Foreground="#475569"
                        BorderThickness="1"
                        BorderBrush="#CBD5E1"
                        Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" 
                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                CornerRadius="8" 
                                                Padding="16,8">
                                            <ContentPresenter HorizontalAlignment="Center" 
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#E2E8F0"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</Window>


